<font color=$getVar(gui_html_font_colour) size=$getVar(gui_html_font_size) face=$getVar(gui_html_font_name)>

<table border="0" VALIGN='center' style="border-collapse: collapse" width="100%" cellpadding="1" cellspacing="1" bgcolor="$getVar(gui_html_table_bg_colour)">

<tr VALIGN='center' ALIGN='left' NAME='SNUM_REFINEMENT_PROGRAM'>
	<td width="2" bgcolor="$getVar(gui_html_table_firstcol_colour)"></td>
	<td width='50%' align='left' colspan=2>
		<b>Refinement Program</b>
	</td>
	<td VALIGN='center' colspan=2 align="right">
		<font size='2'>
			<input
				type='combo',
				width='$eval(GetVar(gui_htmlpanelwidth)/2 -20)'
				height="17"
				bgcolor="GetVar(gui_html_input_bg_colour)"
				name='SET_SNUM_REFINEMENT_PROGRAM',
				value='$spy.GetParam(snum.refinement.program)'
				items='$spy.getRefinementPrgs()'
				label='',
				onchange="spy.SetRefinementProgram(GetValue(SET_SNUM_REFINEMENT_PROGRAM))>>UpdateHtml"
				readonly='readonly'
			>
		</font>
	</td>
</tr>

<tr VALIGN='center' ALIGN='left' NAME='SNUM_REFINEMENT_METHOD'>
	<td width="2" bgcolor="$getVar(gui_html_table_firstcol_colour)"></td>
	<td width='50%' align='left' colspan=2>
		<b>Refinement Method</b>
	</td>	
	<td VALIGN='center' colspan=2 align="right">
		<font size='2'> 
			<input 
				type='combo',
				width='$eval(GetVar(gui_htmlpanelwidth)/2 -20)' 
				height="17"
				bgcolor="GetVar(gui_html_input_bg_colour)"
				name='SET_SNUM_REFINEMENT_METHOD',
				value='$spy.GetParam(snum.refinement.method)', 
				items='$spy.getRefinementMethods($spy.GetParam(snum.refinement.program))'
				label='', 
				onchange="spy.SetRefinementProgram(GetValue(SET_SNUM_REFINEMENT_PROGRAM),GetValue(SET_SNUM_REFINEMENT_METHOD))>>UpdateHtml"
				readonly='readonly'
			>
		</font>
	</td>
</tr>

<tr VALIGN='center' ALIGN='left' NAME='SET_REFLECTIONS'>
	<td width="2" bgcolor="$getVar(gui_html_table_firstcol_colour)"></td>
	<td width='50%' align='left' colspan=2>
		<b>Reflection File</b>
	</td>
	<td VALIGN='center' colspan=2 align="right">
		<font size='2'>
			<input 
				type='combo', 
				width='$eval(GetVar(gui_htmlpanelwidth)/2 -20)' 
				height="17"
				bgcolor="GetVar(gui_html_input_bg_colour)"
				name='SNUM_SET_REFLECTIONS', 
				items='$spy.GetHklFileList()', 
				onchange='HKLSrc(GetValue(SNUM_SET_REFLECTIONS))', 
				value='FileName(HKLSrc())', 
				readonly='readonly'
			> 
		</font>
	</td>
</tr>

<tr VALIGN='center' ALIGN='left' NAME='SNUM_REFINEMENT_MAX_CYCLES'>
<td width="2" bgcolor="$getVar(gui_html_table_firstcol_colour)"></td>
	<td VALIGN='center' colspan=3>
		<b>Maximum Refinement Iterations</b>
	</td>
	<td VALIGN='center' ALIGN='right' colspan=1>
		<font size='2'>
			<input
				type='spin',
				width=50,
				height="17"
				bgcolor="GetVar(gui_html_input_bg_colour)"
				name='SET_SNUM_REFINEMENT_MAX_CYCLES',
				value='$spy.GetParam(snum.refinement.max_cycles)',
				onchange="spy.SetMaxCycles(GetValue(SET_SNUM_REFINEMENT_MAX_CYCLES))"
			> 
		</font>
	</td>
</tr>	

<tr VALIGN='center' ALIGN='left' NAME='SNUM_REFINEMENT_MAX_PEAKS'>
	<td width="2" bgcolor="$getVar(gui_html_table_firstcol_colour)"></td>
	<td VALIGN='center' colspan=3>
			 <b>Number of Residual Peaks</b>
	</td>
	<td VALIGN='right' ALIGN='right' colspan=1>
		<font size='2'>
			<input
				type="spin"
				name="SET_SNUM_REFINEMENT_MAX_PEAKS"
				width="50"
				height="17"
				max='1000'
				bgcolor="GetVar(gui_html_input_bg_colour)"
				value='$eval(abs\(spy.GetParam(snum.refinement.max_peaks)))'
				onchange='spy.SetMaxPeaks(GetValue(SET_SNUM_REFINEMENT_MAX_PEAKS))'
			>
		</font>
	</td>
</tr>


$spy.weightGuiDisplay()


<tr VALIGN='center' ALIGN='left' NAME='IGNORE_SETTINGS'>
	<td width="2" bgcolor="$getVar(gui_html_table_firstcol_colour)"></td>
	<td VALIGN='center'  colspan=3>
		<b>
		<a href="
sel atoms where xatom.peak<$spy.GetParam(snum.refinement.auto.pruneQ)&&xatom.peak>0>>
kill sel>>
sel atoms where xatom.peak>$spy.GetParam(snum.refinement.auto.assignQ)>>
name sel C>>
sel -a>>
name sel 1 -c>>
sel atoms where xatom.uiso>$spy.GetParam(snum.refinement.auto.pruneU)>>
kill sel"
target = "Do automatic tidying once - tick the box to do it after every refinement"
>Autotidy
		</a>
		</b>
		<a 
			href="spy.make_help_box -name='refinement-settings-h3-autotidy-settings' -popout='True'" 
			target="Help me with this">
			<zimg border="0" src="info.png">
		</a>
	</td>
	<td VALIGN='center' ALIGN='right'  colspan=1>
		<font size='2'>
		<input 
			type='checkbox'  
			width=12  
			height=12 
			name='SNUM_REFINEMENT_AUTO_TIDY' 
			$spy.CheckBoxValue(snum.refinement.auto.tidy) 
			oncheck='spy.SetParam(snum.refinement.auto.tidy,True)' 
			onuncheck='spy.SetParam(snum.refinement.auto.tidy,False)' 
			value=''
		>&nbsp;
		</font>
	</td>
</tr>

<tr VALIGN='center' ALIGN='left' NAME='IGNORE_SETTINGS'>
	<td width="2" bgcolor="$getVar(gui_html_table_firstcol_colour)"></td>
	<td VALIGN='center'  colspan=3>
		<b>
			Graphical Output
		</b>
	</td>
	<td VALIGN='center' ALIGN='right'  colspan=1>
		<font size='2'>
			<input 
				type='checkbox'  
				width=12  
				height=12 
				name='SNUM_REFINEMENT_GRAPHICAL_OUTPUT' 
				$spy.CheckBoxValue(snum.refinement.graphical_output) 
				oncheck='spy.SetParam(snum.refinement.graphical_output,true)' 
				onuncheck='spy.SetParam(snum.refinement.graphical_output,false)>>spy.reset_file_in_OFS(refinement_image.htm)>>UpdateHtml' 
				value=''
			>&nbsp;
		</font>
	</td>
</tr>

<!--<tr VALIGN='center' ALIGN='left' NAME='SNUM_REFINEMENT_UPDATE_WEIGHT'>-->
	<!--<td width="2" bgcolor="$getVar(gui_html_table_firstcol_colour)"></td>-->
	  <!--<td VALIGN='center'  colspan=4>-->
			<!--<a href="spy.save_user_parameters(refinement)">-->
				<!--<b>Save these settings as user default</b>-->
			<!--</a>-->
	  <!--</td>-->
<!--</tr>-->

<!-- #include refinement-settings-h3-autotidy gui\refinement-settings-h3-autotidy-settings.htm;gui\blocks\tool-h3-off.htm;image=refinement-settings-h3-autotidy-settings;colspan=4;onclick=;onclick=;2; -->

<!-- #includeif fs.Exists(refinement-settings-h3-refinement-settings-extra.htm) refinement-settings-h3-refinement-settings-extra refinement-settings-h3-refinement-settings-extra.htm;gui\blocks\tool-h3-off.htm;image=refinement-settings-h3-refinement-settings-extra;colspan=4;onclick=;onclick=;2; -->

<!-- #includeif fs.Exists(refinement_image.htm) refinement_image refinement_image.htm;1; -->

</table>
